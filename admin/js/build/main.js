$(document).ready(function(){function e(e){var t=e.find("input, select"),s=new FormData;return $(".file-input").each(function(){s.append($(this).attr("name"),$(this)[0].files[0])}),t.each(function(){"checkbox"===$(this).attr("type")?$(this).prop("checked")?s.append($(this).attr("name"),1):s.append($(this).attr("name"),0):s.append($(this).attr("name"),$(this).val())}),s}function t(e){e.find("input:visible").val("")}function s(e,t){for(var s=e.val().toLowerCase(),n={"а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"e","ж":"zh","з":"z","и":"i","й":"j","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"c","ч":"ch","ш":"sh","щ":"sh","ъ":"_","ы":"y","ь":"_","э":"e","ю":"yu","я":"ya"," ":"_",_:"_","`":"_","~":"_","!":"_","@":"_","#":"_",$:"_","%":"_","^":"_","&":"_","*":"_","(":"_",")":"_","-":"_","=":"_","+":"_","[":"_","]":"_","\\":"_","|":"_","/":"_",".":"_",",":"_","{":"_","}":"_","'":"_",'"':"_",";":"_",":":"_","?":"_","<":"_",">":"_","№":"_"},o="",i="",r=0;r<s.length;r++)void 0!=n[s[r]]?i==n[s[r]]&&"_"==i||(o+=n[s[r]],i=n[s[r]]):(o+=s[r],i=s[r]);o=a(o),t.val(o)}function a(e){return e=e.replace(/^-/,""),e.replace(/-$/,"")}function n(){i.validator({disable:!0}).on("submit",function(s){if(s.isDefaultPrevented());else{s.preventDefault();var a=e(i);$.ajax({url:"/admin/core/form_handler.php",type:"POST",contentType:!1,processData:!1,cache:!1,dataType:"json",data:a,beforeSend:function(){},success:function(e){console.log(e);e.status;"success"===e.status?(o($(".alert-addSite"),"success","success"),t(i)):o($(".alert-addSite"),"danger","not success")},error:function(e,t,s){console.log("error"),console.log(e),console.log(t),console.log(s)}})}}),r.validator({disable:!0}).on("submit",function(s){if(s.isDefaultPrevented());else{s.preventDefault();var a=e(r);$.ajax({url:"/admin/core/edit_site.php",type:"POST",contentType:!1,processData:!1,cache:!1,dataType:"json",data:a,beforeSend:function(){console.log(a)},success:function(e){console.log(e);e.status;"success"===e.status?(o($(".alert-editSite"),"success","success"),t(i)):o($(".alert-editSite"),"danger","not success")},error:function(e,t,s){console.log("error"),console.log(e),console.log(t),console.log(s)}})}}),l.on("click",function(e){e.preventDefault();var s=$(this).attr("data-site-id"),a=$(this).closest("tr");a.addClass("danger"),confirm("Are you sure to remove this site?")&&$.ajax({url:"/admin/core/remove-site.php",type:"POST",data:{siteId:s},beforeSend:function(){},success:function(e){e=JSON.parse(e),e.status,"success"===e.status?(o($(".alert-removeSite"),"success","success"),t(i),a.remove()):o($(".alert-removeSite"),"danger","not success")}})}),f.on("click",function(){$(this).parent().remove()}),$(function(){u.on("keyup load",function(){return s($(this),c),!1})})}function o(e,t,s){var a;"success"===t?a="alert-success":"info"===t?a="alert-info":"warning"===t?a="alert-warning ":"danger"===t&&(a="alert-danger "),e.addClass(a).find("strong").html(s),e.show().alert(),setTimeout(function(){e.hide()},5e3)}var i=$("#form-addSite"),r=$("#form-editSite"),c=($("#form-addSite-submit"),$("#form-editSite-submit"),$("#alias")),u=$("#site_name"),l=$(".remove-site-button"),d=$(".table_all-sites"),f=$(".js-remove-preview-image");$(".js-tag-item");!function(){n(),$("#date_create").datetimepicker({locale:"ru"}),d.tablesorter(),$("#tags").liveSearch({tags:$(".js-tag-item")})}()}),function(e){e.fn.liveSearch=function(t){var s=e.extend({input:this,tags:e(".liveSearch-tags"),tagsMargin:10,showTimeout:1e3,hideTimeOut:6500},t);return this.each(function(){var a=e(this);s.tags.each(function(){e(this).attr("data-search-term",e(this).text().toLowerCase())}),a.on("keyup",function(){var a=e(this).val().toLowerCase();setTimeout(function(){e(".tags-list").show()},t.showTimeout),s.tags.each(function(){e(this).hasClass("add")||(e(this).filter("[data-search-term *= "+a+"]").length>0||a.length<1?e(this).show():e(this).hide())})}),s.tags.on("click",function(){var t=e("#tags").attr("data-offset");e(this).addClass("add").css({position:"absolute",top:"-39px",left:t+"px"}),a.focus().css("padding-left",+t+e(this).outerWidth()+10+"px").attr("data-offset",+t+e(this).outerWidth()+10).val("")})})}}(jQuery);